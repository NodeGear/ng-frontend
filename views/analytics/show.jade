extends ../layout

block content
	mixin navbar(2)
	
	.container
		.panel.panel-default
			.panel-heading
				h1.panel-title Global App Analytics
			.panel-body
				p Here are global analytics sorted in descending order (time finished request)
				p Showing 
					code= analytics.length
					|  requests, average 
					code= average.toFixed(2)
					| ms per request,
					code= size.toFixed(2)
					| mb transmitted from apps
				p
					code= allTotal
					|  total requests, average 
					code= allAverage.toFixed(2)
					| ms per request, 
					code= allSize.toFixed(2)
					| mb transmitted from apps
			table.table
				thead
					tr
						th Start
						th Time
						th Down
						th Up
						th Hostname
						th Request
						th URL
						th Status
						th Drone
						th 404?
				tbody
					for row in analytics
						tr
							td
								= row.start.getDate()
								| /
								= row.start.getMonth()+1
								|  
								= row.start.getHours()
								| :
								= row.start.getMinutes()
								| :
								= row.start.getSeconds()
								| s
							td= row.end - row.start
								| ms
							td
								- size = row.resSize
								if size < 1024
									= size
									| b
								else
									- size = size / 1024
									if size < 1024
										= size.toFixed(2)
										| kb
									else
										= size.toFixed(2)
										| mb
							td= row.reqSize
								| b
							td= row.hostname
							td= row.request
							td= row.url
							td= row.statusCode
							td
								if row.drone
									a(href="/app/"+row.drone._id)= row.drone.name
							td
								if row.found
									| Nah
								else
									| YES