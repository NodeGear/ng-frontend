doctype
html(ng-app="nodecloud")
	head
		meta(http-equiv="Content-Type", content="text/html; charset=utf-8;")
		meta(name="_csrf", content="#{token}")
		meta(name="viewport" content="width=device-width, initial-scale=1.0")
		block meta
		title NodeGear
		link(href="/favicon.ico" type="image/x-icon" rel="icon")
		link(href="/favicon.ico" type="image/x-icon" rel="shortcut icon")
		block css
			link(rel="stylesheet" href="/css/bootstrap.min.css")
			link(rel="stylesheet" href="/css/bootstrap-theme.min.css")
			link(rel="stylesheet" href="/css/font-awesome.min.css")
			link(rel="stylesheet" href="/css/nodegear.css")

	body
		include inc/navbar
		include inc/flash
		
		.container
			.row
				.col-md-4.col-md-offset-4
					.login-panel.panel.panel-default
						.panel-heading
							h3.panel-title.text-center NodeGear Authentication
						.panel-body(ng-init="showTFA = #{requiresTFA}")
							form(name="login" ng-controller="SignInController" ng-init="setCsrf('#{token}')" ng-hide="showTFA")
								fieldset
									p.text-center(ng-show="status.length > 0") {{status}}
									.form-group
										input.form-control(placeholder="Email" type="email" autofocus="" required ng-model="user.email")
									.form-group
										input.form-control(placeholder="Password" type="password" required ng-model="user.password")
									.form-group
										button.btn.btn-lg.btn-success.btn-block(ng-disabled="login.$invalid" ng-click="authenticate(user)")
											i.fa.fa-key.fa-fw
											|  Authenticate
							form(name="confirm" ng-controller="TFAController" ng-init="loginAction = true; init()" ng-show="showTFA")
								fieldset
									p.text-center(ng-show="tfa.status.length > 0") {{tfa.status}}
									.form-group
										input.form-control(placeholder="Two Factor Authentication Token" type="text" autofocus="" required ng-model="tfa.token")
									.form-group
										button.btn.btn-lg.btn-success.btn-block(ng-disabled="tfa.hide || confirm.$invalid" ng-click="confirmTFA('#{token}')")
											i.fa.fa-key.fa-fw
											|  Confirm
					a.btn.btn-link.btn-block(href="/logout" ng-show="showTFA") Cancel Authentication
			.row
				.col-xs-12.col-md-12.col-sm-12.col-lg-12
					footer
						br
						p.text-center NodeGear
							br
							a(href) Contact
							|  | 
							a(href) Support
							|  | 
							a(href) System Status
						p.text-center
							span.text-muted v#{version}-##{versionHash}
						br
		
		block js
			script(src="/js/jquery.min.js" defer)
			script(src="/js/bootstrap.min.js" defer)
			script(src="/js/jquery.metisMenu.js" defer)
			script(src="/js/sb-admin.js" defer)
			script(src="/js/angular.min.js" defer)
			script(src="/js/angular-signin.js" defer)
			script(src="/js/ng-tfa.js" defer)